const express = require("express");
const tr = require("tor-request");
const puppeteer = require('puppeteer');
const app = express();

tr.TorControlPort.password = "giraffe";

async function start()
{
	const ports = [
		'9050',
		'9052',
		'9053',
		'9054'
	];
	let portindex = 0;

	async function target() {
		const browser = await puppeteer.launch({
	    	headless: true,
	    	args: [
	      		'--no-sandbox',
	      		'--disable-setuid-sandbox',
	      		`--proxy-server=socks5://127.0.0.1:${ports[3]}`,
			    '--disable-dev-shm-usage',
			    '--disable-accelerated-2d-canvas',
			    '--no-first-run',
			    '--no-zygote',
			    '--single-process',
			    '--disable-gpu'
	    	]
	  	});

		const page = await browser.newPage();

		page.goto("https://yubo.live/en?referral=XN3G2BQB3&source=whoadd")
		.then(() => {
			browser.close();
			renewIP();
			target();
		});
	}

	target();
}

function renewIP(){
	tr.renewTorSession(function(err, msg){
		if(err)
			console.log(err);
		else
			console.log(msg);
	});
}

start();

const PORT = 3002;
app.listen(PORT, () => {
	console.log(`Server running on port ${PORT}`);
});